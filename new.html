<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* 竖屏旋转容器而非body，避免大小重计算 */
    .rotated-wrapper {
      transform: rotate(90deg);
      transform-origin: center center;
      position: fixed;
      top: 50%;
      left: 50%;
      /* 交换宽高 */
      width: 100vh;
      height: 100vw;
      margin-top: -50vw;
      margin-left: -50vh;
      overflow: hidden;
    }

    .rotated-wrapper #container {
      width: 100%;
      height: 100%;
    }

    #wrapper {
      width: 100vw;
      height: 100vh;
      overflow: auto;
    }

    #container {
      position: relative;
      /* 尺寸由 JS 动态设置 */
      display: inline-block;
    }

    #bg {
      position: absolute;
      top: 0;
      left: 0;
      min-width: 100%;
      min-height: 100%;
    }

    @font-face {
      font-family: DinkieBitmap-9px;
      src: url("font/DinkieBitmap-9px.ttf");
    }

    @font-face {
      font-family: crayon;
      src: url("font/crayon_1-1.ttf");
    }

    @font-face {
      font-family: HanyiSentyCrayon;
      src: url("font/HanyiSentyCrayon.ttf");
    }

    @font-face {
      font-family: HanyiSentyMeadow;
      src: url("font/HanyiSentyMeadow.ttf");
    }

    #clock {
      box-sizing: border-box;
      color: #ffffc6;
      text-shadow: 0 0 3px #d1312a, 0 0 3px #d1312a, 0 0 5px #d1312a, 0 0 5px #d1312a;
      background-color: black;
      position: absolute;
      z-index: 999;
      padding: 4px;
      margin: 0;
      /* 初始值，会被 JS 覆盖 */
      top: 189px;
      left: 304px;
      width: 176px;
      height: 94px;
    }

    #clock:hover {
      display: none;
    }

    #blackboard {
      box-sizing: border-box;
      position: absolute;
      z-index: 999;
      padding: 4px;
      margin: 0;
      text-align: center;
      font-family: HanyiSentyMeadow;
      color: whitesmoke;
      display: flex;
      flex-direction: column;
      justify-content: center;
      /* 初始值，会被 JS 覆盖 */
      top: 311px;
      left: 700px;
      width: 1136px;
      height: 298px;
      font-size: 3em;
    }

    #blackboard:hover {
      display: none;
    }

    #person {
      position: absolute;
      bottom: 0px;
      z-index: 1000;
      -webkit-animation: linear infinite;
      -webkit-animation-name: run;
      -webkit-animation-duration: 200s;
      animation: linear infinite;
      animation-name: run;
      animation-duration: 200s;
      /* 初始值，会被 JS 覆盖 */
      width: 300px;
    }

    #person:hover {
      transform: scale(1.6);
      -webkit-transform-origin: bottom center 0;
    }

    #audio-btn {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 999;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    #audio-btn:hover {
      background: rgba(0, 0, 0, 0.6);
    }

    #audio-btn svg {
      width: 20px;
      height: 20px;
      fill: rgba(255, 255, 255, 0.8);
    }

    #audio-btn.muted svg {
      fill: rgba(255, 255, 255, 0.4);
    }

    @-webkit-keyframes run {
      0% {
        left: 0;
      }
      50% {
        left: calc(100% - 300px);
      }
      100% {
        left: 0;
      }
    }

    @keyframes run {
      0% {
        left: 0;
      }
      50% {
        left: calc(100% - 300px);
      }
      100% {
        left: 0;
      }
    }

    #blackboard > p {
      width: 100%;
      display: inline-block;
      margin: 0px;
      padding: 0px;
    }

    #clock > p {
      font-family: DinkieBitmap-9px;
      text-align: center;
      margin: 0px;
      padding: 0px;
      font-size: 20px;
      line-height: 1.3;
    }
      }
    }
  </style>

  <meta name="theme-color" content="#fafafa">
</head>

<body>
<div id="wrapper">
  <div id="container">
    <img src="img/classroom_background.jpg" id="bg">
    <div id="clock">
      <p>{{date}}</p>
      <p>{{day}}</p>
      <p>{{time}}</p>
    </div>
    <div id="blackboard">
      <p> 万里归来颜愈少，微笑，笑时犹带岭梅香。</p>
      <p>试问岭南应不好，却道：此心安处是吾乡。</p>
    </div>
    <img src="img/noelle.png" id="person">
    <button id="audio-btn" title="播放/暂停">
      <svg viewBox="0 0 24 24" id="audio-icon">
        <path d="M8 5v14l11-7z"/>
      </svg>
    </button>
  </div>
</div>
<audio id="bgm" loop>
  <source src="audio/南山南财大.mp3" type="audio/mpeg"/>
</audio>
<script>
  // 音频自动播放和控制
  const audioBtn = document.getElementById('audio-btn');
  const audioIcon = document.getElementById('audio-icon');
  const bgm = document.getElementById('bgm');

  const playIcon = '<path d="M8 5v14l11-7z"/>';
  const pauseIcon = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
  const mutedIcon = '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>';

  let isAutoplayBlocked = false;

  function updateIcon() {
    if (isAutoplayBlocked) {
      // 自动播放被阻止，显示静音图标
      audioIcon.innerHTML = mutedIcon;
      audioBtn.classList.add('muted');
    } else if (bgm.paused) {
      // 已暂停，显示播放图标
      audioIcon.innerHTML = playIcon;
      audioBtn.classList.add('muted');
    } else {
      // 播放中，显示暂停图标
      audioIcon.innerHTML = pauseIcon;
      audioBtn.classList.remove('muted');
    }
  }

  audioBtn.addEventListener('click', () => {
    if (bgm.paused) {
      bgm.play().then(() => {
        updateIcon();
      }).catch(() => {
        // 浏览器阻止自动播放
      });
    } else {
      bgm.pause();
      updateIcon();
    }
  });

  bgm.addEventListener('play', updateIcon);
  bgm.addEventListener('pause', updateIcon);

  // 尝试自动播放
  function tryAutoplay() {
    bgm.play().then(() => {
      isAutoplayBlocked = false;
      updateIcon();
    }).catch(() => {
      // 浏览器阻止自动播放
      isAutoplayBlocked = true;
      updateIcon();
    });
  }

  // 页面加载后尝试自动播放
  window.addEventListener('load', tryAutoplay);
  // 用户首次交互后尝试播放
  document.addEventListener('click', function onFirstClick() {
    if (bgm.paused) {
      bgm.play().then(() => {
        isAutoplayBlocked = false;
        updateIcon();
      });
    }
    document.removeEventListener('click', onFirstClick);
  }, { once: true });
</script>
<script src="js/main.js"></script>
<script>
  // 原始图片尺寸和元素位置（基于 1920x1080）
  const ORIGINAL_WIDTH = 1920;
  const ORIGINAL_HEIGHT = 1080;
  const ORIGINAL_CLOCK = {
    top: 189,
    left: 304,
    width: 176,
    height: 94,
    fontSize: 20
  };
  const ORIGINAL_BLACKBOARD = {
    top: 311,
    left: 700,
    width: 1136,
    height: 298
  };
  const ORIGINAL_PERSON = {
    width: 300
  };

  let currentScale = 1;

  // 根据容器尺寸调整所有元素 - 以短边为准保持比例
  function adjustLayout() {
    const bg = document.getElementById('bg');
    const clock = document.getElementById('clock');
    const clockTexts = clock.querySelectorAll('p');
    const blackboard = document.getElementById('blackboard');
    const person = document.getElementById('person');
    const container = document.getElementById('container');

    // 使用 window 尺寸计算，避免滚动条影响
    // 在旋转模式下，CSS 已经交换了宽高，这里直接使用即可
    let containerWidth = window.innerWidth;
    let containerHeight = window.innerHeight;

    // 竖屏旋转时，视觉上的宽高与 window 相反，但 CSS 已经处理了，所以这里直接用 window 尺寸
    // 实际上，我们需要的是未旋转前的逻辑尺寸
    const wrapper = document.getElementById('wrapper');
    const isRotated = wrapper.classList.contains('rotated-wrapper');
    if (isRotated) {
      // 旋转后，视觉宽 = window.innerHeight，视觉高 = window.innerWidth
      // 但我们要以视觉上的短边为准
      containerWidth = window.innerHeight;
      containerHeight = window.innerWidth;
    }

    // 计算缩放比例：以长边为准（cover 模式，填满视窗）
    const scaleX = containerWidth / ORIGINAL_WIDTH;
    const scaleY = containerHeight / ORIGINAL_HEIGHT;
    currentScale = Math.max(scaleX, scaleY);

    // 应用图片尺寸 - cover 模式：以长边为准，填满视窗
    const imgWidth = ORIGINAL_WIDTH * currentScale;
    const imgHeight = ORIGINAL_HEIGHT * currentScale;
    bg.style.width = imgWidth + 'px';
    bg.style.height = imgHeight + 'px';

    // 设置容器尺寸 - 确保至少和视窗一样大，无留白
    container.style.width = Math.max(imgWidth, containerWidth) + 'px';
    container.style.height = Math.max(imgHeight, containerHeight) + 'px';

    // 应用时钟位置和大小（左上角对齐，无偏移）
    clock.style.left = (ORIGINAL_CLOCK.left * currentScale) + 'px';
    clock.style.top = (ORIGINAL_CLOCK.top * currentScale) + 'px';
    clock.style.width = (ORIGINAL_CLOCK.width * currentScale) + 'px';
    clock.style.height = (ORIGINAL_CLOCK.height * currentScale) + 'px';

    // 调整时钟字体大小
    const newFontSize = ORIGINAL_CLOCK.fontSize * currentScale;
    clockTexts.forEach(p => {
      p.style.fontSize = newFontSize + 'px';
    });

    // 应用黑板位置和大小
    blackboard.style.left = (ORIGINAL_BLACKBOARD.left * currentScale) + 'px';
    blackboard.style.top = (ORIGINAL_BLACKBOARD.top * currentScale) + 'px';
    blackboard.style.width = (ORIGINAL_BLACKBOARD.width * currentScale) + 'px';
    blackboard.style.height = (ORIGINAL_BLACKBOARD.height * currentScale) + 'px';
    blackboard.style.fontSize = (48 * currentScale) + 'px'; // 3em ≈ 48px

    // 应用人物大小
    person.style.width = (ORIGINAL_PERSON.width * currentScale) + 'px';

    // 更新动画
    updatePersonAnimation(currentScale);
  }

  // 动态更新人物动画
  function updatePersonAnimation(scale) {
    const personWidth = ORIGINAL_PERSON.width * scale;
    const imgWidth = ORIGINAL_WIDTH * scale;

    // 创建或更新动画样式
    let styleEl = document.getElementById('person-animation');
    if (!styleEl) {
      styleEl = document.createElement('style');
      styleEl.id = 'person-animation';
      document.head.appendChild(styleEl);
    }

    styleEl.textContent = `
      @keyframes run {
        0% { left: 0; }
        50% { left: ${imgWidth - personWidth}px; }
        100% { left: 0; }
      }
      @-webkit-keyframes run {
        0% { left: 0; }
        50% { left: ${imgWidth - personWidth}px; }
        100% { left: 0; }
      }
    `;
  }

  // Vue 时钟
  var clock = new Vue({
    el: '#clock',
    data: {
      date: '2023年05月06日',
      day: '星期六',
      time: '17时00分',
    }
  });

  var week = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
  setInterval(updateTime, 1000);
  updateTime();

  function updateTime() {
    var cd = new Date();
    clock.time = zeroPadding(cd.getHours(), 2) + '时' + zeroPadding(cd.getMinutes(), 2) + '分' + zeroPadding(cd.getSeconds(), 2) + '秒';
    clock.date = zeroPadding(cd.getFullYear(), 4) + '-' + zeroPadding(cd.getMonth() + 1, 2) + '-' + zeroPadding(cd.getDate(), 2);
    clock.day = week[cd.getDay()];
  };

  function zeroPadding(num, digit) {
    var zero = '';
    for (var i = 0; i < digit; i++) {
      zero += '0';
    }
    return (zero + num).slice(-digit);
  }

  // 竖屏自动旋转 - 通过 wrapper 实现，避免重绘
  function checkOrientation() {
    const wrapper = document.getElementById('wrapper');
    const isPortrait = window.innerHeight > window.innerWidth;
    if (isPortrait) {
      wrapper.classList.add('rotated-wrapper');
    } else {
      wrapper.classList.remove('rotated-wrapper');
    }
    // 旋转后立即重新计算布局
    adjustLayout();
  }
  window.addEventListener('resize', checkOrientation);
  window.addEventListener('load', checkOrientation);
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>
</body>

</html>
